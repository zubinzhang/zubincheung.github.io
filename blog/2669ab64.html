<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>redis cluster的批量操作 | Zubin | Later Equals Never</title>

  
  <meta name="author" content="Zubin">
  

  
  <meta name="description" content="之前项目中都在使用redis的单机或者主从，后来迁移到集群的时候，出现了一系列问题，下面整理一下redis集群方面的知识。">
  

  
  
  <meta name="keywords" content="Redis">
  

  <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  <meta property="og:title" content="redis cluster的批量操作"/>

  <meta property="og:site_name" content="Zubin"/>

  
  <meta property="og:image" content="/favicon.ico"/>
  

  <link href="/favicon.ico" rel="icon">
  <link rel="alternate" href="/atom.xml" title="Zubin" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
<meta name="generator" content="Hexo 5.4.2"></head>


<body>
<div class="blog">
  <div class="content">

    <header>
  <div class="site-branding">
    <h1 class="site-title">
      <a href="/">Zubin</a>
    </h1>
    <p class="site-description">Later Equals Never</p>
  </div>
  <nav class="site-navigation">
    <ul>
      
    </ul>
  </nav>
</header>

    <main class="site-main posts-loop">
    <article>

  
    
    <h3 class="article-title"><span>redis cluster的批量操作</span></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/blog/2669ab64.html" rel="bookmark">
        <time class="entry-date published" datetime="2020-07-10T07:05:06.000Z">
          2020-07-10
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>之前项目中都在使用redis的单机或者主从，后来迁移到<strong>集群</strong>的时候，出现了一系列问题，下面整理一下redis集群方面的知识。</p>
<span id="more"></span>
<h3 id="Redis集群介绍"><a href="#Redis集群介绍" class="headerlink" title="Redis集群介绍"></a>Redis集群介绍</h3><p>redis cluster是<strong>去中心化</strong>的，每个节点都是master,将数据按key<strong>哈希</strong>到16384个<em>slot</em>上，每个redis node负责一部分的<em>slot</em>。</p>
<p>按照<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/CAP%E5%AE%9A%E7%90%86">CAP理论</a>来说，**单机版的Redis属于保证CP(Consistency &amp; Partition-Tolerancy)而牺牲A(Availability)**，也就说Redis能够保证所有用户看到相同的数据（一致性，因为Redis不自动冗余数据）和网络通信出问题时，暂时隔离开的子系统能继续运行（分区容忍性，因为Master之间没有直接关系，不需要通信），但是不保证某些结点故障时，所有请求都能被响应（可用性，某个Master结点挂了的话，那么它上面分片的数据就无法访问了）。</p>
<p>有了Cluster功能后，<strong>Redis从一个单纯的NoSQL内存数据库变成了分布式NoSQL数据库，CAP模型也从CP变成了AP</strong>。也就是说，通过自动分片和冗余数据，Redis具有了真正的分布式能力，某个结点挂了的话，因为数据在其他结点上有备份，所以其他结点顶上来就可以继续提供服务，保证了<strong>可用性</strong>(Availability)。然而，也正因为这一点，Redis无法保证曾经的强一致性了。这也是CAP理论要求的，三者只能取其二。</p>
<h3 id="Redis集群的功能限制"><a href="#Redis集群的功能限制" class="headerlink" title="Redis集群的功能限制"></a>Redis集群的功能限制</h3><p>Redis<strong>集群</strong>相对<strong>单机</strong>在功能上存在一些限制，需要<strong>开发人员</strong>提前了解，在使用时做好规避。</p>
<ul>
<li><p>key<strong>批量操作</strong>支持有限。<br>类似 mset、mget 操作，目前只支持对具有相同 slot 值的 key 执行 <strong>批量操作</strong>。对于<strong>映射为不同</strong> slot 值的 key 由于执行 mget、mget 等操作可能存在于多个节点上，因此不被支持。</p>
</li>
<li><p>key<strong>事务操作</strong>支持有限。<br>只支持多key在<strong>同一节点上</strong>的事务操作，当多个key分布在<strong>不同</strong>的节点上时<strong>无法</strong>使用事务功能。</p>
</li>
<li><p>key 作为<strong>数据分区</strong>的最小粒度<br>不能将一个<strong>大的键值</strong>对象如 hash、list 等映射到<strong>不同的节点</strong>。</p>
</li>
<li><p>不支持<strong>多数据库空间</strong><br><strong>单机</strong>下的Redis可以支持<em>16</em>个数据库（db0~db15），<strong>集群模式</strong>下只能使用<em>一个</em>数据库空间，即db0。</p>
</li>
<li><p><strong>复制结构</strong>只支持一层<br><strong>从节点</strong>只能复制<strong>主节点</strong>，不支持<strong>嵌套树状复制</strong>结构。</p>
</li>
</ul>
<h3 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h3><ul>
<li><a target="_blank" rel="noopener" href="https://redis.io/topics/cluster-tutorial">cluster-tutorial</a></li>
<li><a target="_blank" rel="noopener" href="https://juejin.im/post/5b8fc5536fb9a05d2d01fb11">Redis集群模式搭建与原理详解</a></li>
</ul>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/数据库/">数据库</a>
    </span>
    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/Redis/">Redis</a>
    </span>
    

    </div>

    
  </div>
</article>

  






    </main>

    <footer class="site-footer">
  <p class="site-info">
    Proudly powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and
    Theme by <a href="https://github.com/CodeDaraW/Hacker" target="_blank">Hacker</a>
    </br>
    
    &copy; 2022 Zubin
    
  </p>
</footer>
    
    
  </div>
</div>
</body>
</html>