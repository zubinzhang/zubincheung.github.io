<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>JavaScript实现四则混合运算 | Zubin | Later Equals Never</title>

  
  <meta name="author" content="Zubin">
  

  
  <meta name="description" content="背景最近在项目中需要自己解析四则混合运算，如果只是简单的加减乘除运算，我相信对大家来说没有任何困难，但是实现带括号的四则运算，还是有一定的难度的。

操作数：小数、整数
运算符：加、减、乘、除
分界符：圆括号 ( ) ， 用于指示运算的先后顺序

这里使用逆波兰表达式解决数值运算以及括号带来的优先级">
  

  
  
  <meta name="keywords" content="Node.js">
  

  <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  <meta property="og:title" content="JavaScript实现四则混合运算"/>

  <meta property="og:site_name" content="Zubin"/>

  
  <meta property="og:image" content="/favicon.ico"/>
  

  <link href="/favicon.ico" rel="icon">
  <link rel="alternate" href="/atom.xml" title="Zubin" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
<meta name="generator" content="Hexo 5.4.2"></head>


<body>
<div class="blog">
  <div class="content">

    <header>
  <div class="site-branding">
    <h1 class="site-title">
      <a href="/">Zubin</a>
    </h1>
    <p class="site-description">Later Equals Never</p>
  </div>
  <nav class="site-navigation">
    <ul>
      
    </ul>
  </nav>
</header>

    <main class="site-main posts-loop">
    <article>

  
    
    <h3 class="article-title"><span>JavaScript实现四则混合运算</span></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/blog/42728bd.html" rel="bookmark">
        <time class="entry-date published" datetime="2019-01-22T03:31:39.000Z">
          2019-01-22
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>最近在项目中需要自己解析四则混合运算，如果只是简单的加减乘除运算，我相信对大家来说没有任何困难，但是实现带括号的四则运算，还是有一定的难度的。</p>
<ul>
<li>操作数：小数、整数</li>
<li>运算符：加、减、乘、除</li>
<li>分界符：圆括号 ( ) ， 用于指示运算的先后顺序</li>
</ul>
<p>这里使用<strong>逆波兰表达式</strong>解决数值运算以及括号带来的优先级提升问题。</p>
<h2 id="逆波兰表达式"><a href="#逆波兰表达式" class="headerlink" title="逆波兰表达式"></a>逆波兰表达式</h2><ul>
<li><p>中缀表达式(Infix Notation)<br>是一个通用的算术或逻辑公式表示方法， 操作符是以中缀形式处于操作数的中间。比如<code>1 + 2 + 3</code></p>
</li>
<li><p>前缀表达式(Prefix Notation)<br>是指将运算符写在前面、操作数写在后面、不包含括号的表达式，而且为了纪念其发明者波兰数学家 Jan Lukasiewicz 所以前缀表达式也叫做<strong>波兰表达式</strong>。比如<code>- 1 + 2 3</code></p>
</li>
<li><p>后缀表达式(Postfix Notation)<br>与之相反，是指运算符写在操作数后面的不含括号的算术表达式，也叫做<strong>逆波兰表达式</strong>。比如<code>1 2 3 + -</code></p>
</li>
</ul>
<p>前后缀表达式的出现是为了方便计算机处理，它的运算符是按照一定的顺序出现，所以求值过程中并不需要使用括号来指定运算顺序，也不需要考虑运算符号（比如加减乘除）的优先级。<strong>逆波兰表达式</strong>在编译技术中有着普遍的应用。</p>
<h3 id="中缀表达式转换成后缀表达式算法："><a href="#中缀表达式转换成后缀表达式算法：" class="headerlink" title="中缀表达式转换成后缀表达式算法："></a>中缀表达式转换成后缀表达式算法：</h3><ol>
<li>从左至右扫描一中缀表达式。</li>
<li>若读取的是操作数，则判断该操作数的类型，并将该操作数存入操作数堆栈</li>
<li>若读取的是运算符：<ol>
<li>该运算符为左括号”(“，则直接存入运算符堆栈。</li>
<li>该运算符为右括号”)”，则输出运算符堆栈中的运算符到操作数堆栈，直到遇到左括号为止。</li>
<li>该运算符为非括号运算符：<ol>
<li>若运算符堆栈栈顶的运算符为括号，则直接存入运算符堆栈。</li>
<li>若比运算符堆栈栈顶的运算符优先级高或相等，则直接存入运算符堆栈。</li>
<li>若比运算符堆栈栈顶的运算符优先级低或者优先级相等，则输出栈顶运算符到操作数堆栈，直到比运算符堆栈栈顶的运算符优先级低或者为空时才将当前运算符压入运算符堆栈。</li>
</ol>
</li>
<li>当表达式读取完成后运算符堆栈中尚有运算符时，则依序取出运算符到操作数堆栈，直到运算符堆栈为空。</li>
</ol>
</li>
</ol>
<p>流程图如下所示：<br><img src="https://github.com/zubincheung/blog-images/blob/master/2018/reverse-polish.jpg?raw=true" alt=" "></p>
<h3 id="逆波兰表达式求值算法："><a href="#逆波兰表达式求值算法：" class="headerlink" title="逆波兰表达式求值算法："></a>逆波兰表达式求值算法：</h3><ol>
<li>循环扫描语法单元的项目。</li>
<li>如果扫描的项目是操作数，则将其压入操作数堆栈，并扫描下一个项目。</li>
<li>如果扫描的项目是一个二元运算符，则对栈的顶上两个操作数执行该运算。</li>
<li>如果扫描的项目是一个一元运算符，则对栈的最顶上操作数执行该运算。</li>
<li>将运算结果重新压入堆栈。</li>
<li>重复步骤 2-5，堆栈中即为结果值。</li>
</ol>
<h3 id="算法实现"><a href="#算法实现" class="headerlink" title="算法实现"></a>算法实现</h3><ul>
<li>中缀表达式转换成逆波兰表达式</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> operatorRand = &#123;</span><br><span class="line">  <span class="string">&#x27;+&#x27;</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="string">&#x27;-&#x27;</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="string">&#x27;*&#x27;</span>: <span class="number">2</span>,</span><br><span class="line">  <span class="string">&#x27;/&#x27;</span>: <span class="number">2</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 中缀表达式转换成逆波兰表达式</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">string[]</span>&#125; str 中缀表达式</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">convert</span>(<span class="params">inputArr</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="title class_">Array</span>.<span class="title function_">isArray</span>(inputArr) || inputArr.<span class="property">length</span> === <span class="number">0</span>) <span class="keyword">return</span> [];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> operatorArr = [];</span><br><span class="line">  <span class="keyword">const</span> outputArr = [];</span><br><span class="line"></span><br><span class="line">  inputArr.<span class="title function_">forEach</span>(<span class="function"><span class="params">input</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title class_">Number</span>.<span class="built_in">isNaN</span>(<span class="title class_">Number</span>(input))) &#123;</span><br><span class="line">      <span class="comment">// 如果是数字，只接输出</span></span><br><span class="line">      outputArr.<span class="title function_">push</span>(input);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (input === <span class="string">&#x27;(&#x27;</span>) &#123;</span><br><span class="line">      <span class="comment">// 如果是左括号，入操作符栈</span></span><br><span class="line">      operatorArr.<span class="title function_">push</span>(input);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (input === <span class="string">&#x27;)&#x27;</span>) &#123;</span><br><span class="line">      <span class="comment">// 如果是右括号，循环输出，知道匹配到左括号为止</span></span><br><span class="line">      <span class="keyword">while</span> (operatorArr.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> operator = operatorArr.<span class="title function_">pop</span>();</span><br><span class="line">        <span class="keyword">if</span> (operator === <span class="string">&#x27;(&#x27;</span>) <span class="keyword">break</span>;</span><br><span class="line">        outputArr.<span class="title function_">push</span>(operator);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// 如果是运算符</span></span><br><span class="line">      <span class="keyword">while</span> (operatorArr.<span class="property">length</span> &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> topOperator = operatorArr[operatorArr.<span class="property">length</span> - <span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 如果运算符栈为空，或者栈顶运算符是(，或者当前运算符优先级比栈顶运算符优先级高</span></span><br><span class="line">        <span class="keyword">if</span> (</span><br><span class="line">          operatorArr.<span class="property">length</span> === <span class="number">0</span> ||</span><br><span class="line">          topOperator === <span class="string">&#x27;(&#x27;</span> ||</span><br><span class="line">          operatorRand[input] &gt; operatorRand[topOperator]</span><br><span class="line">        ) &#123;</span><br><span class="line">          operatorArr.<span class="title function_">push</span>(input);</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          outputArr.<span class="title function_">push</span>(operatorArr.<span class="title function_">pop</span>());</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 输入循环结束，如果运算符栈不为空，循环输出</span></span><br><span class="line">  <span class="keyword">while</span> (operatorArr.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    outputArr.<span class="title function_">push</span>(operatorArr.<span class="title function_">pop</span>());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> outputArr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>逆波兰算法求值</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">compute</span>(<span class="params">leftNum, rightNum, operator</span>) &#123;</span><br><span class="line">  <span class="keyword">switch</span> (operator) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;+&#x27;</span>:</span><br><span class="line">      <span class="keyword">return</span> leftNum + rightNum;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;-&#x27;</span>:</span><br><span class="line">      <span class="keyword">return</span> leftNum - rightNum;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;*&#x27;</span>:</span><br><span class="line">      <span class="keyword">return</span> leftNum * rightNum;</span><br><span class="line">    <span class="attr">default</span>:</span><br><span class="line">      <span class="comment">// 除法</span></span><br><span class="line">      <span class="keyword">return</span> leftNum / rightNum;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 计算逆波兰表达式</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">string</span>&#125; str 逆波兰表达式</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">count</span>(<span class="params">reversePolishArr</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="title class_">Array</span>.<span class="title function_">isArray</span>(reversePolishArr) || reversePolishArr.<span class="property">length</span> === <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> tmpArr = [];</span><br><span class="line"></span><br><span class="line">  reversePolishArr.<span class="title function_">forEach</span>(<span class="function"><span class="params">input</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title class_">Number</span>.<span class="built_in">isNaN</span>(<span class="title class_">Number</span>(input))) &#123;</span><br><span class="line">      <span class="comment">// 数字接直接push</span></span><br><span class="line">      tmpArr.<span class="title function_">push</span>(<span class="title class_">Number</span>(input));</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// 运算符</span></span><br><span class="line">      <span class="keyword">const</span> num1 = tmpArr.<span class="title function_">pop</span>();</span><br><span class="line">      <span class="keyword">const</span> num2 = tmpArr.<span class="title function_">pop</span>();</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">isNaN</span>(num1) || <span class="built_in">isNaN</span>(num2)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">`无效的表达式：<span class="subst">$&#123;reversePolishArr.join(<span class="string">&#x27;,&#x27;</span>)&#125;</span>`</span>);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      tmpArr.<span class="title function_">push</span>(<span class="title function_">compute</span>(num2, num1, input));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Number</span>(tmpArr[<span class="number">0</span>].<span class="title function_">toFixed</span>(<span class="number">3</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>完整代码请参考：<a target="_blank" rel="noopener" href="https://github.com/zubincheung/js-rpn">https://github.com/zubincheung/js-rpn</a></p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/JavaScript/">JavaScript</a>
    </span>
    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/Node-js/">Node.js</a>
    </span>
    

    </div>

    
  </div>
</article>

  






    </main>

    <footer class="site-footer">
  <p class="site-info">
    Proudly powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and
    Theme by <a href="https://github.com/CodeDaraW/Hacker" target="_blank">Hacker</a>
    </br>
    
    &copy; 2022 Zubin
    
  </p>
</footer>
    
    
  </div>
</div>
</body>
</html>